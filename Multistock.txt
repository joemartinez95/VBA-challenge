Sub testcode()    'assign variables    Dim newticker As String    Dim tickercount As Double    Dim yearopen As Double    Dim yearclose As Double    Dim change As Double    Dim percent As Double    Dim volume As Double    Dim Lookup_Value As Double    Dim Lookup_Array1 As Range    Dim Lookup_Array2 As Range    Dim Return_Array As Range    Dim lrow As Long    Dim ws As Worksheet     For Each ws In Sheets    'set ranges for data population and summary    Set Lookup_Array1 = ws.Range("K:K")    Set Lookup_Array2 = ws.Range("L:L")    Set Return_Array = ws.Range("I:I")    lrow = ws.Cells(Rows.Count, 1).End(xlUp).Row        ws.Range("I1").Value = "Ticker"    ws.Range("J1").Value = "Yearly Change"    ws.Range("K1").Value = "Percent Change"    ws.Range("L1").Value = "Total Stock Volume"    ws.Range("O2").Value = "Greatest % Increase"    ws.Range("O3").Value = "Greatest % Decrease"    ws.Range("O4").Value = "Greatest Total Volume"    ws.Range("P1").Value = "Ticker"    ws.Range("Q1").Value = "Value"            'set initial volume, tickercount, and year open values    volume = 0    tickercount = 0    yearopen = ws.Cells(2, 3).Value        'set loop    For I = 1 To lrow           'volume calculation        If tickercount > 0 Then        volume = volume + ws.Cells(I, 7).Value                End If                'volume = volume + Cells(j, 7).Value             'calculation for tickers         If ws.Cells(I + 1, 1).Value <> ws.Cells(I, 1).Value Then            tickercount = tickercount + 1            newticker = ws.Cells(I + 1, 1).Value            ws.Cells(tickercount + 1, 9).Value = newticker        End If                'calculation for change, percent, and total        If ws.Cells(I + 1, 1).Value <> ws.Cells(I, 1).Value And tickercount > 1 Then        yearclose = ws.Cells(I, 6).Value            change = yearclose - yearopen        percent = yearclose / yearopen - 1        ws.Cells(tickercount, 10).Value = change        ws.Cells(tickercount, 11).Value = percent        ws.Cells(tickercount, 11).NumberFormat = "0.00%"            If change < 0 Then                ws.Cells(tickercount, 10).Interior.ColorIndex = 3                                ElseIf change > 0 Then                ws.Cells(tickercount, 10).Interior.ColorIndex = 4            End If                         If percent < 0 Then                ws.Cells(tickercount, 11).Interior.ColorIndex = 3                                ElseIf percent > 0 Then                ws.Cells(tickercount, 11).Interior.ColorIndex = 4            End If                    yearopen = ws.Cells(I + 1, 3).Value        ws.Cells(tickercount, 12).Value = volume        volume = 0            End If               Next I             'populate data summary    ws.Range("Q2").Value = WorksheetFunction.Max(ws.Columns(11))    ws.Range("Q2").NumberFormat = "0.00%"    ws.Range("Q3").Value = WorksheetFunction.Min(ws.Columns(11))    ws.Range("Q3").NumberFormat = "0.00%"    ws.Range("Q4").Value = WorksheetFunction.Max(ws.Columns(12))        ws.Range("P2").Value = Application.WorksheetFunction.XLookup(ws.Range("Q2").Value, Lookup_Array1, Return_Array)    ws.Range("P3").Value = Application.WorksheetFunction.XLookup(ws.Range("Q3").Value, Lookup_Array1, Return_Array)    ws.Range("P4").Value = Application.WorksheetFunction.XLookup(ws.Range("Q4").Value, Lookup_Array2, Return_Array)    Next ws    End Sub